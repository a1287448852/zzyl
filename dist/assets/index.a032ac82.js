import{d as Z,r as s,C as K,e as S,o as N,h as V,i as h,w as E,q as e,z as U,g as _,_ as ee,M as L,p as le,m as ne,y as me,R as se,n as q,F as X,E as ue,a5 as w,a9 as P,$ as ge,f as Y,a0 as be,u as de,B as O,aa as De}from"./index.c5b6faf2.js";import{a as ye,e as ie,b as Ce,d as ke,c as xe,f as re,h as Ne}from"./permission.69e815b3.js";import{D as Fe}from"./disable.4394386d.js";import{N as Be}from"./index.ea73f821.js";const ce=p=>(le("data-v-5e6ccf10"),p=p(),ne(),p),Ee={class:"dialog-form"},Se={class:"dialog-header"},$e={class:"dialog-title"},Re=ce(()=>e("span",{class:"information"},null,-1)),Ie=ce(()=>e("span",null,"\u53D6\u6D88",-1)),Le=[Ie],Ae=ce(()=>e("button",{theme:"primary",type:"submit",class:"bt btn-submit"},[e("span",null,"\u786E\u5B9A")],-1)),Ve=Z({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>({})},title:{type:String,default:"\u6DFB\u52A0\u89D2\u8272"}},emits:["handleClose","fetchData"],setup(p,{emit:$}){const b=p,m=s("empty"),D=$,y=s(!1),i=s({roleName:"",dataState:"0"}),F=s(""),k=s(),z=o=>{o.validateResult===!0&&(b.title==="\u65B0\u589E\u89D2\u8272"?g(i.value):M(i.value))},g=async o=>{ye(o).then(a=>{a.code===200&&(L.success("\u89D2\u8272\u6DFB\u52A0\u6210\u529F"),D("fetchData"),x())})},M=o=>{ie(o).then(a=>{a.code===200&&(L.success("\u89D2\u8272\u4FEE\u6539\u6210\u529F"),x(),D("fetchData"))})},x=()=>{k.value.reset(),y.value=!1,D("handleClose")};K(()=>b.visible,()=>{y.value=b.visible,F.value=b.title}),K(()=>b.data,o=>{i.value=JSON.parse(JSON.stringify(o)),console.log(i.value,"formData.value")});const t={roleName:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",type:"error",trigger:"blur"},{trigger:"blur",validator:o=>(console.log(o,"fffff"),(o==null?void 0:o.trim())?!0:{result:!1,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",type:"error"})}],dataState:[{required:!0,message:"\u8BF7\u9009\u62E9\u89D2\u8272\u72B6\u6001",type:"error",trigger:"change"}]};return(o,a)=>{const f=S("t-input"),R=S("t-form-item"),u=S("t-form"),v=S("t-dialog");return N(),V("div",Ee,[h(v,{visible:y.value,"onUpdate:visible":a[1]||(a[1]=I=>y.value=I),footer:!1,"on-close":x},{header:E(()=>[e("div",Se,[e("span",$e,U(F.value),1),Re])]),body:E(()=>[_(" \u8868\u5355\u5185\u5BB9 "),h(u,{ref_key:"form",ref:k,data:i.value,rules:t,"label-width":80,"label-align":"left","on-cancel":"onClickCloseBtn","reset-type":m.value,onSubmit:z},{default:E(()=>[h(R,{label:"\u89D2\u8272\u540D\u79F0: ",name:"roleName"},{default:E(()=>[h(f,{modelValue:i.value.roleName,"onUpdate:modelValue":a[0]||(a[0]=I=>i.value.roleName=I),maxlength:10,"show-limit-number":"",placeholder:"\u8BF7\u8F93\u5165",clearable:""},null,8,["modelValue"])]),_:1}),h(R,{style:{float:"right"},class:"footer-btn"},{default:E(()=>[e("div",{class:"bt bt-grey btn-submit",onClick:x},[...Le]),Ae]),_:1})]),_:1},8,["data","reset-type"]),_(" end ")]),_:1},8,["visible"])])}}});var Te=ee(Ve,[["__scopeId","data-v-5e6ccf10"],["__file","D:/project/2023/project-zzyl-v2.1/project-zzyl-admin-vue3-java/src/pages/permission/role/components/DialogForm.vue"]]);const Q=p=>(le("data-v-5f441180"),p=p(),ne(),p),ze={class:"roleCont pd-box"},Me={class:"head fx fx-sb"},je={class:"searchBox"},we={class:"roleTable fx-fd-col"},Pe=Q(()=>e("div",{class:"fx-1"},"\u89D2\u8272\u540D\u79F0",-1)),He=Q(()=>e("div",{class:"fx-1"},"\u89D2\u8272\u72B6\u6001",-1)),Ue=Q(()=>e("div",{class:"fx-1"},"\u64CD\u4F5C",-1)),Oe=[Pe,He,Ue],qe={class:"tabList pt-rt fx-1"},Je=["onClick"],Ke=["title"],Qe={class:"fx-1"},Ge={class:"fx-1"},We=["onClick"],Xe=["onClick"],Ye=["onClick"],Ze=Q(()=>e("span",{class:"topTag"},null,-1)),et=Q(()=>e("span",{class:"botTag"},null,-1)),tt=[Ze,et],at={class:"pageCont"},ot=Z({__name:"RoleList",props:{defaultIndex:{type:Number,default:()=>0}},emits:["clickRow"],setup(p,{expose:$,emit:b}){me(()=>{});const m=p,D=s(!1),y=s(),i=s(0),F=s("\u89D2\u8272"),k=s({}),z=s("\u89D2\u8272"),g=se({pageNum:1,pageSize:10,roleName:""}),M=b,x=s(!1),t=async()=>{Ce(g).then(c=>{c.code===200?(y.value=c.data.records,i.value=Number(c.data.total),x.value=i.value!==0,M("clickRow",y.value[n.value]),console.log(i.value,n.value,"----"),i.value<n.value+1&&A(y.value[0].id,0)):L.error(c.msg)}).catch(()=>{})},o=c=>{k.value=c,c.dataState==="0"?D.value=!0:a()},a=()=>{D.value=!1,f()},f=async()=>{ie({...k.value,dataState:k.value.dataState==="0"?"1":"0"}).then(c=>{c.code===200&&(L.success(`${k.value.dataState==="0"?"\u7981\u7528":"\u542F\u7528"}\u6210\u529F`),t())})},R=()=>{g.pageNum=1,n.value=0,t()},u=s(NaN),v=s(),I=(c,H)=>{c.dataState==="0"?L.error("\u542F\u7528\u72B6\u6001\u4E0B\u4E0D\u53EF\u5220\u9664"):(u.value=c.id,v.value=H,G.value=!0)},l=()=>{G.value=!1,r()},r=async()=>{ke({roleIds:u.value}).then(c=>{c.code===200?(L.success("\u5220\u9664\u6210\u529F"),t(),n.value===v.value&&(n.value=0)):L.error(c.msg)}).catch(()=>{})},d=s({dataState:"0"}),C=s({...g}),n=s(0),A=(c,H)=>{n.value!==H&&(n.value=H,M("clickRow",c))},T=s("\u65B0\u589E\u89D2\u8272"),j=s(!1),J=()=>{T.value="\u65B0\u589E\u89D2\u8272",j.value=!0},ve=c=>{c&&(T.value="\u7F16\u8F91\u89D2\u8272",j.value=!0,d.value=c)},G=s(!1),ae=()=>{j.value=!1,G.value=!1,D.value=!1,d.value={dataState:"0"}},_e=c=>{g.pageNum=c,n.value=0,t()};return K(()=>m.defaultIndex,c=>{n.value=c}),$({fetchData:t}),(c,H)=>{const pe=S("t-icon"),fe=S("t-input"),he=S("t-pagination");return N(),V(X,null,[e("div",ze,[e("div",Me,[e("div",je,[h(fe,{modelValue:g.roleName,"onUpdate:modelValue":H[0]||(H[0]=B=>g.roleName=B),placeholder:"\u8BF7\u8F93\u5165",clearable:"",onChange:R},{prefixIcon:E(()=>[h(pe,{name:"search"})]),_:1},8,["modelValue"])]),e("div",{class:"bt",onClick:J},"\u65B0\u589E\u89D2\u8272")]),_(" \u89D2\u8272\u8868\u683C - start - "),e("div",we,[e("div",{class:q(["tabHead fx",{"bd-non":n.value===0}])},[...Oe],2),e("div",qe,[(N(!0),V(X,null,ue(y.value,(B,W)=>(N(),V("div",{key:B.id,class:q(["fx pt-rt z-1 pt",{"bd-non":n.value===W||n.value-1===W}]),onClick:oe=>A(B,W)},[e("p",{class:"fx-1",title:B.roleName},U(B.roleName),9,Ke),e("div",Qe,[e("span",{class:q(`status-dot status-dot-${B.dataState==="0"?"1":"0"}`)},U(B.dataState==="0"?"\u542F\u7528":"\u7981\u7528"),3)]),e("div",Ge,[e("span",{class:"font-del btn-split-right",onClick:oe=>I(B,W)},"\u5220\u9664",8,We),e("a",{class:q(`${B.dataState==="0"?"btn-dl":""} line btn-split-right`),onClick:oe=>o(B)},U(B.dataState==="0"?"\u7981\u7528":"\u542F\u7528"),11,Xe),e("span",{class:"font-bt",onClick:oe=>ve(B)},"\u7F16\u8F91",8,Ye)])],10,Je))),128)),w(e("div",{class:"activeRow",style:ge({top:`${n.value*51}px`})},[...tt],4),[[P,x.value]]),w(h(Be,null,null,512),[[P,!x.value]])]),e("div",at,[i.value>10?(N(),Y(he,{key:0,total:i.value,showPageSize:!1,showPreviousAndNextBtn:"",totalContent:!1,onCurrentChange:_e},null,8,["total"])):_("v-if",!0)])]),_(" \u89D2\u8272\u8868\u683C - end - ")]),_(" \u65B0\u589E\uFF0C\u7F16\u8F91\u5F39\u7A97 "),h(Te,{visible:j.value,title:T.value,data:d.value,"form-data":C.value,onHandleClose:ae,onFetchData:t},null,8,["visible","title","data","form-data"]),_(" end "),_(" \u5220\u9664\u5F39\u5C42 "),h(be,{visible:G.value,"delete-text":F.value,onHandleDelete:l,onHandleClose:ae},null,8,["visible","delete-text"]),_(" end "),_(" \u7981\u7528\u542F\u7528\u5F39\u5C42 "),h(Fe,{visible:D.value,dataState:k.value.dataState,confirmText:z.value,onHandleClick:a,onHandleClose:ae},null,8,["visible","dataState","confirmText"])],64)}}});var st=ee(ot,[["__scopeId","data-v-5f441180"],["__file","D:/project/2023/project-zzyl-v2.1/project-zzyl-admin-vue3-java/src/pages/permission/role/components/RoleList.vue"]]);const ut={class:"menuCont"},lt={class:"treeRow fx"},nt=["onClick"],ct={class:"fx-1"},rt={key:0,class:"noBut"},dt={class:"childCont"},it=Z({__name:"MenuList",props:{data:{type:Array,default:()=>[]},isChildren:{type:Boolean,default:!1},type:{type:String},defaultData:{type:Array,default:()=>[]}},setup(p){const $=de(),b=p;K(()=>b.defaultData,t=>{F.value=t||[]},{deep:!0}),K(()=>b.type,t=>{m.value=t});const m=s(""),D=s([]),y=t=>{D.value=D.value.includes(t.resourceNo)?[]:[t.resourceNo],t.children.length>0&&(i.value=i.value.includes(t.resourceNo)?[]:[t.resourceNo])},i=s([]),F=s([]),k=t=>{console.log(t,"data");const{val:o,checked:a}=t;if(o.resourceType==="r"&&!a){o.checkbox=a;return}o.checkbox=a,o.children.length>0&&x([z($.menuListdata,o.resourceNo)],a),o.parentResourceNo!==100001e9&&g($.menuListdata,o.parentResourceNo),o.isIndeterminate=!1,console.log($.menuListdata,"??????")},z=(t,o)=>{for(const a of t){if(a.resourceNo===o)return a;if(a.children&&a.children.length>0){const f=z(a.children,o);if(f)return f}}return null},g=(t,o)=>{t.forEach(a=>{M(a,o)})},M=(t,o)=>{var R;let a=0,f=0;t.resourceNo===o?(t.children.forEach(u=>{u.isIndeterminate?f++:u.checkbox&&a++}),t.checkbox=a===t.children.length,t.isIndeterminate=(f>0||a>0)&&a<t.children.length,t.parentResourceNo!==100001e9&&g($.menuListdata,t.parentResourceNo)):((R=t==null?void 0:t.children)==null?void 0:R.length)>0&&g(t.children,o)},x=(t,o)=>{console.log(t,o,"?????"),t.forEach(a=>{a.checkbox=o,a.isIndeterminate=!1,a.children.length>0&&x(a.children,o)})};return(t,o)=>{const a=S("t-icon"),f=S("t-checkbox"),R=S("MenuList",!0);return N(),V("div",ut,[(N(!0),V(X,null,ue(p.data.filter(u=>u.resourceType==="m"||u.resourceType==="c"),u=>(N(),V("div",{key:u.resourceNo,class:"menuContContent"},[e("div",lt,[e("div",{class:"icon",onClick:v=>y(u)},[h(a,{name:"chevron-right-circle",class:q({open:D.value.includes(u.resourceNo)})},null,8,["class"])],8,nt),e("div",ct,[e("div",null,U(u.resourceName),1),w(e("div",{class:q(["cont",u.children.length>3?"active":""])},[_(" {{ getCheckList(item) }} "),_(` <t-checkbox\r
              v-if="item.children.some((n) => n.resourceType === 'r')"\r
              key="all"\r
              class="btnCheckbox"\r
              :check-all="true"\r
              label="\u5168\u9009"\r
              :disabled="!pageType"\r
            /> `),(N(!0),V(X,null,ue(u.children.filter(v=>v.resourceType==="r"),v=>(N(),Y(f,{key:v.resourceNo,modelValue:v.checkbox,"onUpdate:modelValue":I=>v.checkbox=I,class:"btnCheckbox",disabled:!m.value,onChange:I=>k({val:v,checked:I})},{default:E(()=>[O(U(v.resourceName),1)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]))),128)),u.children.every(v=>v.resourceType!=="r")?(N(),V("span",rt," \u6682\u65E0\u6309\u94AE\uFF01 ")):_("v-if",!0)],2),[[P,D.value.includes(u.resourceNo)]])]),e("div",null,[(N(),Y(f,{key:u.checkbox,modelValue:u.checkbox,"onUpdate:modelValue":v=>u.checkbox=v,disabled:!m.value,indeterminate:u.isIndeterminate,onChange:v=>k({val:u,checked:v})},null,8,["modelValue","onUpdate:modelValue","disabled","indeterminate","onChange"]))])]),w(e("div",dt,[h(R,{type:p.type,data:u.children,defaultData:p.defaultData},null,8,["type","data","defaultData"])],512),[[P,i.value.includes(u.resourceNo)]])]))),128))])}}});var vt=ee(it,[["__scopeId","data-v-d692a52e"],["__file","D:/project/2023/project-zzyl-v2.1/project-zzyl-admin-vue3-java/src/pages/permission/role/components/MenuList.vue"]]);const te=p=>(le("data-v-0b303de5"),p=p(),ne(),p),_t={class:"roleAdmin min-h fx"},pt={class:"permissionCont pd-box"},ft={class:"head fx fx-sb"},ht=te(()=>e("div",{class:"menuTitle"},"\u83DC\u5355\u6743\u9650",-1)),mt={class:"btnContent"},gt=te(()=>e("span",null,"\u53D6\u6D88",-1)),bt=[gt],Dt={class:"dataPmCont fx"},yt=te(()=>e("div",{class:"title"},"\u6570\u636E\u8303\u56F4\uFF1A",-1)),Ct={class:"dataPmTree fx"},kt=te(()=>e("div",{class:"label"},"\u7EC4\u7EC7\uFF1A",-1)),xt=Z({__name:"index",setup(p){const $=de();De(()=>{z()});const b=s(null),m=s(""),D=s([]),y=s("1"),i=s(!1),F=s([]),k=s([]),z=async()=>{i.value=!0,xe().then(l=>{i.value=!1,l.code===200?(k.value=l.data,b.value.fetchData(),console.log(F.value,$.menuListdata,"\u83B7\u53D6\u83DC\u5355\u5E73\u94FA\u6570\u636E")):L.error(l.msg)}).catch(()=>{i.value=!1})},g=l=>{l==null||l.forEach(r=>{let d=0,C=0;r.children.forEach(n=>{n.isIndeterminate?C++:n.checkbox&&d++}),r.isIndeterminate=(C>0||d>0)&&d<r.children.length,r.children&&r.children.length&&g(r.children)})},M=s(),x=s(0),t=l=>{console.log(l,"params"),Ne(l.id).then(r=>{m.value="",a.id=l.id,a.checkedResourceNos=r.data||[],M.value=r.data||[],x.value=Math.random(),F.value=o(k.value),g(F.value),g(F.value),$.setMenuListdata([...F.value])})},o=l=>{var C;const r=[],d={};for(const n of l)d[n.resourceNo]={...n,children:[],checkbox:a.checkedResourceNos.findIndex(A=>A===n.resourceNo)!==-1};for(const n of l){const{resourceNo:A,parentResourceNo:T}=n,j=d[A];T===1e14||T==="100000000000000"?r.push(j):(d[T]||(d[T]={children:[]}),n.dataState==="0"&&d[T].children.push({...j,btnList:j.children.filter(J=>J.resourceType==="r").map(J=>J.resourceNo)}))}return(C=r[0])==null?void 0:C.children},a=se({id:NaN,checkedResourceNos:[]}),f=se({id:NaN,dataScope:"",checkedDeptNos:[]}),R=l=>{f.dataScope=l},u=()=>{m.value="",t(a)},v=l=>{let r=[];for(let d=0;d<l.length;d++){const C=l[d];(C.checkbox||C.isIndeterminate)&&r.push(C.resourceNo),C.children.length>0&&(r=r.concat(v(C.children)))}return r},I=async()=>{if(!m.value){m.value="edit";return}if(y.value==="1")a.checkedResourceNos=v($.menuListdata),re(a).then(l=>{l.code===200&&(L.success(l.msg),m.value="",b.value.fetchData())});else{if(!f.checkedDeptNos.length){L.error("\u8BF7\u9009\u62E9\u7EC4\u7EC7");return}re(f).then(l=>{l.code===200&&(L.success(l.msg),m.value="",b.value.fetchData())})}};return(l,r)=>{const d=S("t-radio"),C=S("t-radio-group"),n=S("t-tree");return N(),V("div",_t,[_(" \u89D2\u8272\u5217\u8868\u6A21\u5757 - start "),h(st,{ref_key:"childRole",ref:b,onClickRow:t},null,512),_(" \u89D2\u8272\u5217\u8868\u6A21\u5757 - end "),_(" \u89D2\u8272\u5BF9\u5E94\u7684\u6743\u9650\u6A21\u5757 - start "),e("div",pt,[e("div",ft,[ht,_(` <t-space direction="vertical">\r
          <t-radio-group\r
            v-model="activeInd"\r
            variant="default-filled"\r
            default-value="1"\r
            @change="handleChange"\r
          >\r
            <t-radio-button value="1">\u83DC\u5355\u6743\u9650</t-radio-button>\r
            <t-radio-button value="2">\u6570\u636E\u6743\u9650</t-radio-button>\r
          </t-radio-group>\r
        </t-space> `),e("div",mt,[w(e("button",{theme:"primary",type:"submit",class:"bt-grey wt-60",onClick:u},[...bt],512),[[P,m.value==="edit"]]),e("div",{class:"bt",onClick:I},U(m.value?"\u4FDD\u5B58":"\u7F16\u8F91"),1)])]),_(" \u83DC\u5355\u6743\u9650 - start "),w(e("div",null,[(N(),Y(vt,{key:x.value,data:F.value,defaultData:a.checkedResourceNos,type:m.value},null,8,["data","defaultData","type"]))],512),[[P,y.value==="1"]]),_(" \u83DC\u5355\u6743\u9650 - end "),_(" \u6570\u636E\u6743\u9650 - start "),w(e("div",null,[e("div",Dt,[yt,h(C,{modelValue:f.dataScope,"onUpdate:modelValue":r[0]||(r[0]=A=>f.dataScope=A),"default-value":"1",disabled:!m.value,onChange:R},{default:E(()=>[h(d,{value:"4"},{default:E(()=>[O("\u5168\u90E8")]),_:1}),h(d,{value:"3"},{default:E(()=>[O("\u672C\u7EA7\u53CA\u5B50\u7EA7")]),_:1}),h(d,{value:"2"},{default:E(()=>[O("\u672C\u7EA7")]),_:1}),h(d,{value:"1"},{default:E(()=>[O("\u4E2A\u4EBA")]),_:1}),h(d,{value:"0"},{default:E(()=>[O("\u81EA\u5B9A\u4E49")]),_:1})]),_:1},8,["modelValue","disabled"])]),w(e("div",Ct,[kt,h(n,{modelValue:f.checkedDeptNos,"onUpdate:modelValue":r[1]||(r[1]=A=>f.checkedDeptNos=A),data:D.value,"expand-all":"",checkable:"",disabled:!m.value},null,8,["modelValue","data","disabled"])],512),[[P,f.dataScope==="0"]])],512),[[P,y.value==="2"]]),_(" \u6570\u636E\u6743\u9650 - end ")]),_(" \u89D2\u8272\u5BF9\u5E94\u7684\u6743\u9650\u6A21\u5757 - end ")])}}});var St=ee(xt,[["__scopeId","data-v-0b303de5"],["__file","D:/project/2023/project-zzyl-v2.1/project-zzyl-admin-vue3-java/src/pages/permission/role/index.vue"]]);export{St as default};
